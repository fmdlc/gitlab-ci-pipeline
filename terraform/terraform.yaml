##----------------------------------------------
## Terraform pipeline
##----------------------------------------------
---
image:
  name: ${TF_IMAGE}
  entrypoint:
    - '/usr/bin/env'
    - 'PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'

before_script:
  - rm -rf .terraform

.terraform-init:
  allow_failure: false
  stage: terraform-init
  artifacts:
    paths:
      - .terraform
  script:
    - terraform init

.terraform-plan:
  allow_failure: false
  stage: terraform-plan
  artifacts:
    paths:
      - state.plan
  script:
    - terraform plan -out=state.plan

.terraform-apply:
  allow_failure: false
  stage: terraform-apply
  script:
    - terraform apply -auto-approve "state.plan"
